/**
 * Made with ❤️ by Mighty — Maestro LLC
 * Copyright © 2025 Maestro LLC
 */(()=>{"use strict";function e(e,t,s,a){return new(s||(s=Promise))(function(n,i){function o(e){try{d(a.next(e))}catch(e){i(e)}}function r(e){try{d(a.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,r)}d((a=a.apply(e,t||[])).next())})}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;const t=["MIGHTY_INTERACTIVE_CORE_LOADED","MIGHTY_INTERACTIVE_HEIGHT_REPORT","MIGHTY_INTERACTIVE_POST_CORE_LOADED_REPORT","MIGHTY_INTERACTIVE_DIRECT_CODE_HTML_REQUESTED","MIGHTY_INTERACTIVE_DIRECT_CODE_HTML_REPORT","MIGHTY_INTERACTIVE_READY_TO_DISPLAY","MIGHTY_INTERACTIVE_COMPLETE","MIGHTY_INTERACTIVE_SCREENCAP","MIGHTY_INTERACTIVE_DYNAMIC_FORM_CONFIG","MIGHTY_INTERACTIVE_RELOAD_REQUESTED","MIGHTY_INTERACTIVE_SDK_HOST_PING","MIGHTY_INTERACTIVE_SDK_HOST_PONG","MIGHTY_INTERACTIVE_SDK_STATE_REQUESTED","MIGHTY_INTERACTIVE_SDK_STATE_PROVIDED","MIGHTY_INTERACTIVE_ERROR","MIGHTY_INTERACTIVE_SDK_MESSAGE_TO_HOST","MIGHTY_INTERACTIVE_SDK_MESSAGE_FROM_HOST"];function s(e){return"object"==typeof e&&null!==e&&"object"==typeof e.data&&null!==e.data&&t.includes(e.data.type)}class a{constructor(){this.messageHandlers=new Map,this.customMessageHandlers=new Map,this.pendingCallbacks=new Map,this.requestIdCounter=0,this.listenToPostMessagesRelatedToSDK()}generateRequestId(){return`req_${Date.now()}_${++this.requestIdCounter}`}onMessageReceived(e,t){var s;return this.messageHandlers.has(e)||this.messageHandlers.set(e,new Set),null===(s=this.messageHandlers.get(e))||void 0===s||s.add(t),()=>{var s;null===(s=this.messageHandlers.get(e))||void 0===s||s.delete(t)}}sendHostPingMessage(){this.postMessageToInteractiveBlockWindow({type:"MIGHTY_INTERACTIVE_SDK_HOST_PING"})}sendStateRequestedMessage(e){this.postMessageToInteractiveBlockWindow({type:"MIGHTY_INTERACTIVE_SDK_STATE_REQUESTED",data:{defaultState:e}})}sendMarkAsCompleteMessage(){this.postMessageToInteractiveBlockWindow({type:"MIGHTY_INTERACTIVE_COMPLETE"})}sendMessageToHost(e){const t=e.callback?this.generateRequestId():void 0;t&&e.callback&&this.pendingCallbacks.set(t,e.callback),this.postMessageToInteractiveBlockWindow({type:"MIGHTY_INTERACTIVE_SDK_MESSAGE_TO_HOST",data:{messageType:e.messageType,payload:e.payload,requestId:t}})}onMessageFromHost(e){var t;const{messageType:s,callback:a}=e;return this.customMessageHandlers.has(s)||this.customMessageHandlers.set(s,new Set),null===(t=this.customMessageHandlers.get(s))||void 0===t||t.add(a),()=>{var e;null===(e=this.customMessageHandlers.get(s))||void 0===e||e.delete(a)}}listenToPostMessagesRelatedToSDK(){window.addEventListener("message",e=>{if(s(e)){const t=e.data.type;switch(t){case"MIGHTY_INTERACTIVE_SDK_HOST_PONG":this.handleMessageReceived(t,e.data.data);break;case"MIGHTY_INTERACTIVE_SDK_STATE_PROVIDED":this.handleMessageReceived(t,e.data.data.state);break;case"MIGHTY_INTERACTIVE_SDK_MESSAGE_FROM_HOST":e.data.data.requestId?this.handleResponseCallback(e.data.data.requestId,e.data.data.payload):this.handleCustomMessageFromHost(e.data.data.messageType,e.data.data.payload)}}})}postMessageToInteractiveBlockWindow(e){window.parent!==window&&window.parent.postMessage(e,"*")}handleMessageReceived(e,t){const s=this.messageHandlers.get(e);s&&s.forEach(e=>{e(null!=t?t:void 0)})}handleCustomMessageFromHost(e,t){const s=this.customMessageHandlers.get(e);s&&s.forEach(e=>{e(t)})}handleResponseCallback(e,t){const s=this.pendingCallbacks.get(e);s&&(s(t),this.pendingCallbacks.delete(e))}}class n{getState(e,t){return Promise.resolve(e)}}class i{constructor(e){this.messenger=e}getState(t){return e(this,void 0,void 0,function*(){return new Promise((e,s)=>{const a=setTimeout(()=>{s(new Error("Interactive state not provided in time"))},5e3);this.messenger.onMessageReceived("MIGHTY_INTERACTIVE_SDK_STATE_PROVIDED",t=>{clearTimeout(a),e(t)}),this.messenger.sendStateRequestedMessage(t)})})}}const o=new class{constructor(){this.version="1.0.0",this.sdkIsReady=!1,this.messenger=new a,this.useNoOpMode=!1}initialize(){return e(this,void 0,void 0,function*(){var e;(yield this.checkForHost())||(this.useNoOpMode=!0),this.useNoOpMode?this.state=new n:this.state=new i(this.messenger),this.sdkIsReady=!0,null===(e=this.sdkReadyFn)||void 0===e||e.call(this)})}onSdkReady(e){this.sdkReadyFn=e,this.sdkIsReady&&e()}markAsComplete(){this.messenger.sendMarkAsCompleteMessage()}sendMessageToHost(e){this.messenger.sendMessageToHost(e)}onMessageFromHost(e){return this.messenger.onMessageFromHost(e)}checkForHost(){return new Promise(e=>{this.messenger.onMessageReceived("MIGHTY_INTERACTIVE_SDK_HOST_PONG",t=>{t&&t.courseId&&t.blockId&&(this.courseId=t.courseId,this.blockId=t.blockId),e(!0)}),setTimeout(()=>{this.messenger.sendHostPingMessage(),setTimeout(()=>{e(!1)},100)},0)})}};window.mightyInteractiveSdk=o,o.initialize();(new class{initialize(){this.postMessageToParentWindow({type:"MIGHTY_INTERACTIVE_CORE_LOADED"}),this.listenForWhenDocumentIsReady(),this.listenForMessagesFromParent()}listenForWhenDocumentIsReady(){this.onDocumentReady()}onDocumentReady(){this.listenForWhenDocumentIsResized()}listenForWhenDocumentIsResized(){this.postMightyInteractiveHeightReport(),new ResizeObserver(()=>{this.postMightyInteractiveHeightReport()}).observe(document.documentElement)}postMightyInteractiveHeightReport(){const e=document.documentElement.getBoundingClientRect().height;this.postMessageToParentWindow({type:"MIGHTY_INTERACTIVE_HEIGHT_REPORT",data:{height:Math.ceil(e)}})}postMessageToParentWindow(e){window.parent.postMessage(e,"*")}listenForMessagesFromParent(){window.addEventListener("message",e=>{if(!s(e))return;const t=e.data;switch(t.type){case"MIGHTY_INTERACTIVE_SCREENCAP":this.onMightyInteractiveScreencapMessage(t);break;case"MIGHTY_INTERACTIVE_POST_CORE_LOADED_REPORT":this.onMightyInteractivePostCoreLoadedReportMessage(t)}})}onMightyInteractiveScreencapMessage(e){if("MIGHTY_INTERACTIVE_SCREENCAP"===e.type){const t=e.data.html,s=(new window.DOMParser).parseFromString(t,"text/html");document.replaceChild(s.documentElement,document.documentElement)}}onMightyInteractivePostCoreLoadedReportMessage(e){if("MIGHTY_INTERACTIVE_POST_CORE_LOADED_REPORT"===e.type){const{injectCss:t,injectJavascript:s}=e.data;this.injectCssAndJavascriptSnippets({cssSnippet:t,javascriptSnippet:s}),this.postMessageToParentWindow({type:"MIGHTY_INTERACTIVE_READY_TO_DISPLAY"})}}injectCssAndJavascriptSnippets(e){var t,s;const{cssSnippet:a,javascriptSnippet:n}=e;if(void 0!==a&&(null===(t=document.querySelector("#mightyInteractiveOverrideCss"))||void 0===t||t.remove(),a)){const e=document.createElement("style");e.id="mightyInteractiveOverrideCss",e.innerHTML=a,document.body.appendChild(e)}if(void 0!==n&&(null===(s=document.querySelector("#mightyInteractiveOverrideJavascript"))||void 0===s||s.remove(),n)){const e=document.createElement("script");e.id="mightyInteractiveOverrideJavascript",e.innerHTML=n,document.body.appendChild(e)}}}).initialize()})();